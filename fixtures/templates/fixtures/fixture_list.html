{% extends 'base.html' %}
{% load custom_filters %}

{% block title %}Club Olimpo | Fixture{% endblock %}

{% block content %}
<div class="text-center mb-5">
    <h1>Fixture y Resultados</h1>
    <p class="lead text-muted">Consultá las fechas, horarios y resultados de todas nuestras categorías.</p>
</div>
{% for category, fixtures_in_category in grouped_by_category.items %}
    <div class="category-group mb-4">
        <h2 class="category-title">{{ category.name }}</h2>
        <hr>
        
        <div class="horizontal-scroll-wrapper">
            {% for fixture in fixtures_in_category %}
                <div class="fixture-card-wrapper">
                    <div class="card fixture-card h-100 shadow-sm">
                        <div class="card-body d-flex flex-column">
                            {# FILA 1: Liga, Torneo, Etapa y Categoría #}
                        <div class="row mb-2 align-items-center text-center">
                            <div class="col-12">
                                {% if fixture.league_name %}
                                    <strong class="d-block small">{{ fixture.league_name }}</strong>
                                {% endif %}
                                <small class="text-muted">
                                    {% if fixture.tournament_name %}{{ fixture.tournament_name }}{% endif %}
                                    {% if fixture.stage %}- {{ fixture.stage }}{% endif %}
                                    {% if fixture.category %} ({{ fixture.category.name }}){% endif %}
                                </small>
                            </div>
                        </div>
                            <hr class="mt-0 mb-3">

                            {# FILA 2: Equipos y Resultado #}
                            <div class="matchup-row">
                                <div class="team-display home-team">
                                    {% if fixture.home_team.shield_image %}<img src="{{ fixture.home_team.shield_image.url }}" alt="{{ fixture.home_team.name }}" class="team-shield">{% endif %}
                                    <span class="team-name fw-bold mt-2" title="{{ fixture.home_team.name }}">{{ fixture.home_team.name }}</span>
                                </div>
                                
                                <div class="score-display">
                                    {% if fixture.home_score is not None %}
                                        {{ fixture.home_score }} - {{ fixture.away_score }}
                                    {% else %}
                                        vs
                                    {% endif %}
                                </div>

                                <div class="team-display away-team">
                                    {% if fixture.away_team.shield_image %}<img src="{{ fixture.away_team.shield_image.url }}" alt="{{ fixture.away_team.name }}" class="team-shield">{% endif %}
                                    <span class="team-name fw-bold mt-2" title="{{ fixture.away_team.name }}">{{ fixture.away_team.name }}</span>
                                </div>
                            </div>

                             {# FILA 3: Fecha, Hora y Lugar #}
                        <div class="row mt-3 text-center">
                            <div class="col-12 text-muted">
                                <small>
                                    {% if fixture.match_datetime %}
                                        {{ fixture.match_datetime|date:"d/m/Y H:i" }} hs{{ fixture|venue_display }}
                                    {% else %}
                                        Fecha y hora a definir
                                    {% endif %}
                                </small>
                            </div>
                        </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
{% empty %}
    <p class="text-center">No hay partidos cargados para las próximas fechas.</p>
{% endfor %}

<hr class="my-5">
{% include 'core/components/_sponsors_section.html' %}

{% endblock %}